## 면접질문

1. 외래키에 의한 조회가 빠를지 아니면 인덱스에 의한 조회가 빠를지
2. InnoDB에 의해 관리되는 외래키에 의해 조회가 index가 없는 FK보다 빠를지
3. index를 적용해야하는 경우에대해 예시를 들어주세요
4. insert가 많은 테이블의 경우 index 갱신 비용이 커지기 때문에 다른 선택지가 있는지(여타 기술을 사용한 방안)
5. 특정 퍼센트가 넘어가면 optimizer가 pull scan을 하는게 효율적이라고 판단하는 근거와 optimizer사용하지 않고 index를 사용하는 방법
  1. optimizer를 실행계획을 모를경우에는 explain을 적용하여 확인
6. 커버링 인덱스를 사용했을때 항상 빠를지(디스크 IO와 엮어서)

# 인덱스

목차

- 인덱스란 ?
- 인덱스 알고리즘
- 인덱스 종류
    - 클러스터링 인덱스
    - 논-클러스터링 인덱스
- 인덱스 적용 기준
    - 카디널리티
- 실습
    - 인덱스 조회
    - 성능 비교
- 인덱스 사용시 주의사항

인덱스란

색인

쉽게 찾아볼 수 있도록 일정한 순서에 따라 놓은 목록

핵심 : **원하는 값**을 빠르게 **찾는다**

SELECT

데이터베이스 인덱스

사람 테이블의

이름, 성별, 이메일 컬럼을 가진 테이블에서

만약 100만건 이상의 데이터가 인덱스의 기준이 하나도 잡혀 있지 않는다면 ?

이메일 abc@gmail.com 을 조회한다면 ?

엄청 느림

왜냐하면 처음부터 순차적으로 조회하기 때문에

현재 데이터는 **기준** 없이 저장된 상태

데이터가 만약 특정 **기준을 정렬**이 되어 있다면 검색을 빠르게 할 수 있음

정렬 기준을 이메일로 하여 현재의 데이터들을 다시 정렬한 상태에서 이메일을 찾는다면 ?

SELECT * FROM member **WHERE** email = ‘abc@gmail.cm’

- 인덱스 적용된 대상
- WHERE 절을 통해 검색

SELECT * FROM member 에서 **WHERE** 절을 통해 검색하지 않았음

이는 인덱스가 **사용되지 않음** 것임

즉 인덱스는 데이터베이스 테이블에 대한 **검색 성능을 향상**시키는 자료구조이며

**WHERE** 절 등을 통해 활용된다

인덱스 특징

- 인덱스는 항상 최신의 정렬 상태를 유지
- 인덱스도 하나의 데이터베이스 객체
- 데이터베이스 크기의 약 10% 정도의 저장공간 필요

인덱스 알고리즘

페이지 : 데이터가 저장되는 단위 (16Kbyte)

Full table Scan

![image](https://user-images.githubusercontent.com/109144975/236252673-be92df35-246b-4112-accc-8fd31e233e42.png)

검증 과정은

총 3개 페이지와

12번의 검색이 들어감

특징

- 순차적으로 접근
- 접근비용 감서

언제 사용 ?

- 적용 가능한 인덱스가 없는 경우
- 인덱스 처리 범위가 넓은 경우
- 크기가 작은 테이블에 엑세스하는 경우

B-Tree

트리 높이가 모두 같음

![image](https://user-images.githubusercontent.com/109144975/236252758-ce93221e-8a78-4453-9bd4-2e1e100de271.png)

B-Tree를 활용한 데이터 검색

만약 위 상황에서 PPP를 찾아보게 된다면 ?

P는 L 다음에 있기 때문에 3번째 페이지로 넘어가서 바로 찾게 된다

![image](https://user-images.githubusercontent.com/109144975/236252958-217dc034-7b57-4228-aea6-e2c444fc3d31.png)

위를 통해 SELECT 의 성능이 향상될 수 있는 것을 알 수 있음

INSERT의 경우

페이지의 공간이 없을때 생긴다

페이지에 새로운 데이터를 추가할 여유공간이 없어 페이지에 변화가 발생

DB가 느려지고 성능에 영향을 준다

DELETE의 경우

인덱스의 데이터를 실제로 지우지 않고 사용안함 표시를 한다

UPDATE

- DELETE 기존값 사용 안함 표시
- INSERT 변경된 값 삽입

과정으로 구현됨

UPDATE, DELETE 의 경우에도 WHERE 절을 사용하면 빨라지지 않을까 ?

라는 의문을 가지게 됨

WHERE 절로 처리할 대상을 찾기 위한 조회 성능은 향상 됨

하지만 사용하지 않는 인덱스에서는 불필요한 처리량 증가

사용안함 표시로 페이지 낭비 및 인덱스 조각화가 심해짐

WHERE절을 사용함으로써

SELECT : 성능이 향상된다

INSERT, UPDATE, DELETE : 페이지 분할과 사용안함 표시로 인덱스의 조각화가 심해져 성능이 저하된다