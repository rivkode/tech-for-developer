아래 내용은 [강민철](https://github.com/kangtegong)님의

- [『혼자 공부하는 컴퓨터 구조+운영체제』 책](https://m.hanbit.co.kr/media/books/book_view.html?p_code=B9177037040)
- [『혼자 공부하는 컴퓨터 구조+운영체제』 유튜브](https://www.youtube.com/watch?v=bls_GjX-4U8&list=PLVsNizTWUw7FCS83JhC1vflK8OcLRG0Hl)

를 참고하였습니다.

<br>


# 멀티프로세스와 멀티스레드의 개념

## 스레드

스레드란 ?

- 프로세스를 구성하는 실행의 흐름 단위
- 스레드를 이용하면 하나의 프로세스에서 여러 부분을 동시에 실행 가능

## 프로세스와 스레드

이전 내용에서의 프로세스는 하나의 프로세스에서 하나의 실행만을 한다고 가정하며 배웠었습니다.

즉, 웹, 게임, 메모장 등 이 모든 프로세스가 하나의 실행 흐름을 가지고 한 번에 하나의 부분만을 각각 실행하는 것들 가정했습니다.
'실행의 흐름 단위가 하나' 일 경우 **단일 스레드 프로세스**라고 볼 수 있습니다.

**스레드**라는 개념이 도입되면서는 하나의 프로세스내에 여러개의 명령어 실행을 동시에 할 수 있게 되었습니다.

![image](https://user-images.githubusercontent.com/109144975/224525771-719f7f79-a8c7-466c-aae4-db350f101cef.png)

**중요 !**

- 프로세스의 스레드들은 실행에 필요한 최소한의 정보(프로그램 카운터를 포함한 레지스터, 스택)만을 유지
- 프로세스 자원을 공유하며 실행
- 스레드들의 고유의 코드, 데이터, 힙 영역이 있는 것이 아니고 같은 프로세스 내에서는 해당 영역을 공유함


> 리눅스에서는 프로세스, 스레드 말 대신 task라는 이름으로 통일하기도 함
>
> **리스누 토르발스(리눅스 창시자)**
>
> - 프로세스와 스레드를 별개의 것으로 구분할 이유가 없다. 전통적으로는 그렇게 해왔지만, 개인적으로 그것은 역사적인 짐과도 같다고 생각한다.
> - 프로세스와 스레드는 그냥 "실행의 문맥"일 뿐이다.


## 멀티 프로세스와 멀티 스레드

멀티 프로세스
- 여러 프로세스를 동시에 실행하는 것
  멀티 스레드
- 여러 스레드로 프로세스를 동시에 실행하는 것

## 질문 : 예를 들어 "hello, os"를 화면에 출력하는 프로그램이 있다고 할때

- 이 프로그램을 3번 fork하여 실행하는 것
- 프로그램내에 스레드를 3개 만들어 실행하는 것
- 둘의 차이는 ? 화면에 보이는 결과는 같지만 뭐가 다를까 ?

> 동일한 작업을 수행하는 단일 스레드 프로세스 여러개 실행 VS 하나의 프로세스를 여러 스레드로 실행
>
> - 프로세스끼리는 서로 자원을 공유하지 않음
> - 스레드끼리는 같은 프로세스 내의 자원을 공유함

## 동일한 작업을 수행하는 단일 스레드 프로세스 여러개 실행
- 프로세스를 fork하여 같은 작업을 하는 동일한 프로세스 2개를 동시에 실행하면 코드 영역, 데이터 영역, 힙 영역 등을 비롯한 모든 자원이 복제되어 메모리에 적재
- fork 를 추가적으로 하면 메모리에 같은 프로세스가 통째로 적재됨
- 이는 어찌보면 낭비임. 왜냐하면 동일한 프로그램을 실행하기 위해 동일한 내용이 메모리에 중복되기 때문

## 하나의 프로세스를 여러 스레드로 실행
- 각기 다른 스레드 ID, 프로그램 카운터 값을 포함한 레지스터 값, 스택을 가짐
- 프로세스의 자원은 스레드끼리 서로 공유
- 같은 프로세스 내 동일한 주소 공간의 코드, 데이터, 힙 영역을 공유
- 이렇게 되면 메모리를 더 효율적으로 사용 가능

### 여러 스레드로 실행 시 단점
- 프로세스 자원을 공유하기 때문에 하나의 스레드에 문제가 생기면 프로세스 전체에 문제가 생길 수 있음
- 모든 스레드는 프로세스 자원을 공유하고, 하나의 스레드에 문제가 생기면 다른 스레드도 영향을 받기 때문

### 프로세스 간 통신
- 프로세스끼리 '기본적으로' 자원을 공유하지 않지만, 프로세스끼리도 충분히 자원을 공유하며 데이터도 주고받을 수 있음
- 이를 프로세스 간 통신 (IPC; Inter-Process Communication)이라고 부름
- 예를 들어 컴퓨터 내에 프로세스 A는 hello.txt에 값을 쓰고, 프로세스 B는 hello.txt.에 값을 읽는다면 이는 데이터를 주고받으므로 프로세스 간의 통신이 일어난다고 할 수 있습니다.
- 공유하는 메모리 영역(공유메모리 : shared memory)을 두어 데이터를 주고받을 수 있음
- 스레드에 비해 까다로울 뿐 프로세스도 프로세스들끼리 공유할 수 있음

## 실습


코드로 스레드 만들기

```python
import threading
import os

def foo():
    print('thread id', threading.get_native_id())
    print('process id', os.getpid())

if __name__ == '__main__':
    print('process id', os.getpid())
    thread = threading.Thread(target=foo).start()
```

실행결과

```python
process id 26264
thread id 2248
process id 26264
```

스레드를 만드는 코드는 마지막줄인 `thread = threading.Thread(target=foo).start()` 입니다.

foo라는 함수를 실행하는 스레드를 만들고 실행하라는 의미입니다.

동일한 작업을 하는 스레드 생성하기

```python
import threading
import os

def foo():
  print('thread id', threading.get_native_id())
  print('process id', os.getpid())

if __name__ == '__main__':
  print('process id', os.getpid())
  thread1 = threading.Thread(target=foo).start()
  thread2 = threading.Thread(target=foo).start()
  thread3 = threading.Thread(target=foo).start()
```

실행결과

```python
process id 11912
thread id 20044
process id 11912
thread id 26056
process id 11912
thread id 21764
process id 11912
```

foo 라는 함수를 실행하는 3개의 스레드를 만들었습니다.

이들은 모두 다른 스레드이지만 process id = 11912 라는 동일한 프로세스를 공유하고 있는 것을 볼 수 있습니다.


## 마무리
- **스레드**는 프로세스 내의 실행 흐름 단위입니다.
- 여러 프로세스를 동시에 실행하는 것을 **멀티프로세스**라고 하고, 여러 스레드로 프로세스를 동시에 실행하는 것을 **멀티스레드**라고 합니다.

# 스레드 요약

- 스레드는 CPU 사용의 기본 단위를 나타내며 동일한 프로세스에 속하는 스레드는 코드 및 데이터를 포함하여 많은 프로세스 자원을 공유한다
- 다중 스레드 응용 프로그램에는 1. 응답성 2. 자원공유 3. 경제성 4. 확장성 이라는 4가지 주요 이점이 있다
- 여러 스레드가 진행 중인 경우 병행성이 존재하는 반면에 여러 스레드가 동시에 진행 중인 경우 병렬성이 존재한다. 단일 CPU가 있는 시스템에서는 오로지 병행성만 가능하고, 병렬성은 여러 CPU를 제공하는 다중 코어 시스템이 필요하다
